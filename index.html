<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Divine Path | Vimshottari Dasha Calculator</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@400;500&display=swap" rel="stylesheet">
<style>
  body {margin:0;padding:0;font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#1f1f2e,#121212);color:#fff;text-align:center;}
  header {padding:20px;font-family:'Playfair Display';font-size:2rem;color:#f8d66d;}
  .container {max-width:800px;margin:auto;padding:20px;background:rgba(255,255,255,0.05);border-radius:20px;box-shadow:0 8px 32px rgba(0,0,0,0.3);}
  label {display:block;margin-top:15px;font-weight:500;}
  input {width:100%;padding:10px;border-radius:8px;border:none;margin-top:8px;font-size:1rem;}
  button {margin-top:20px;padding:12px 20px;background:#f8d66d;color:#000;font-weight:600;border:none;border-radius:12px;cursor:pointer;font-size:1rem;}
  button:hover {background:#ffe68a;}
  .results {margin-top:25px;text-align:left;}
  .dasha-table {width:100%;border-collapse:collapse;margin-top:15px;}
  .dasha-table th,.dasha-table td {border:1px solid #444;padding:8px;text-align:center;}
  .highlight {background:rgba(248,214,109,0.2);font-weight:600;}
  .share-btn {margin-top:15px;background:#1db954;color:#fff;}
</style>
<script defer>
document.addEventListener('DOMContentLoaded',()=>{

const dashaSequence=[
  {lord:'Ketu',years:7},
  {lord:'Venus',years:20},
  {lord:'Sun',years:6},
  {lord:'Moon',years:10},
  {lord:'Mars',years:7},
  {lord:'Rahu',years:18},
  {lord:'Jupiter',years:16},
  {lord:'Saturn',years:19},
  {lord:'Mercury',years:17}
];

function julianDay(y,m,d,h){
  if(m<=2){y-=1;m+=12;}
  const A=Math.floor(y/100);
  const B=2-A+Math.floor(A/4);
  return Math.floor(365.25*(y+4716))+Math.floor(30.6001*(m+1))+d+B-1524.5+(h/24);
}

function moonLongitude(date){
  const y=date.getUTCFullYear();
  const m=date.getUTCMonth()+1;
  const d=date.getUTCDate();
  const h=date.getUTCHours()+date.getUTCMinutes()/60;
  const jd=julianDay(y,m,d,h);
  const T=(jd-2451545.0)/36525;

  // Simplified Moon position approximation (error < 1°)
  const L0=218.3164477+481267.88123421*T; // Mean longitude
  const D=297.8501921+445267.1114034*T;
  const M=357.5291092+35999.0502909*T;
  const M1=134.9633964+477198.8675055*T;

  const lon=L0+6.289*Math.sin(toRad(M1))+1.274*Math.sin(toRad(2*D-M1))+0.658*Math.sin(toRad(2*D))+0.214*Math.sin(toRad(2*M1))-0.186*Math.sin(toRad(M));
  return normalize(lon);
}

function toRad(deg){return deg*Math.PI/180;}
function normalize(x){return ((x%360)+360)%360;}

window.calculateDasha=function(){
  const dob=document.getElementById('dob').value;
  const tob=document.getElementById('time').value;
  const tz=document.getElementById('tz').value;
  if(!dob||!tob||!tz){alert('Please fill all fields');return;}

  const[y,m,d]=dob.split('-').map(Number);
  const[hh,mm]=tob.split(':').map(Number);

  const sign=tz[0]==='-'?-1:1;
  const[th,tm]=tz.slice(1).split(':').map(Number);
  const offset=sign*(th+(tm||0)/60);

  const date=new Date(Date.UTC(y,m-1,d,hh-offset,mm));

  let moonLon=moonLongitude(date);

  const lahiri=23.85;
  let siderealLon=moonLon-lahiri;
  if(siderealLon<0)siderealLon+=360;

  const nakIndex=Math.floor(siderealLon/13.3333);
  const nakFraction=(siderealLon%13.3333)/13.3333;

  const lords=['Ketu','Venus','Sun','Moon','Mars','Rahu','Jupiter','Saturn','Mercury'];
  const startLord=lords[nakIndex%9];

  const dobDate=new Date(dob+'T'+tob+':00');
  let currentDate=new Date(dobDate);

  const startIndex=dashaSequence.findIndex(d=>d.lord===startLord);
  let balance=1-nakFraction;

  let html=`<h3>Moon Longitude: ${siderealLon.toFixed(2)}°</h3>`;
  html+=`<h4>Starting Mahadasha: ${startLord}</h4>`;
  html+=`<table class='dasha-table'><tr><th>Lord</th><th>Start</th><th>End</th></tr>`;

  let index=startIndex;
  for(let i=0;i<dashaSequence.length;i++){
    const lord=dashaSequence[index];
    let years=lord.years;
    if(i===0)years*=balance;

    const start=new Date(currentDate);
    currentDate.setFullYear(currentDate.getFullYear()+Math.floor(years));
    currentDate.setDate(currentDate.getDate()+Math.round((years%1)*365.25));

    html+=`<tr ${i===0?'class="highlight"':''}><td>${lord.lord}</td><td>${start.toDateString()}</td><td>${currentDate.toDateString()}</td></tr>`;

    index=(index+1)%dashaSequence.length;
    balance=1;
  }

  html+=`</table>`;

  document.getElementById('results').innerHTML=html+`<button class='share-btn' onclick='shareResults()'>Share Results</button>`;
}

window.shareResults=function(){
  const text=document.getElementById('results').innerText;
  if(navigator.share){navigator.share({title:'My Vimshottari Dasha',text});}
  else{navigator.clipboard.writeText(text);alert('Results copied to clipboard');}
}

});
</script>
</head>
<body>
<header>Divine Path | Vimshottari Dasha Calculator</header>
<div class="container">
  <label for="dob">Date of Birth:</label>
  <input type="date" id="dob">

  <label for="time">Time of Birth:</label>
  <input type="time" id="time">

  <label for="tz">Timezone Offset (e.g. +05:30):</label>
  <input type="text" id="tz" placeholder="+05:30">

  <button onclick="calculateDasha()">Calculate Dasha</button>

  <div id="results" class="results"></div>
</div>
</body>
</html>
